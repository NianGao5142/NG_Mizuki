name: Content Sync

on:
  push:
    branches: [main]
    paths:
      - 'src/content/**'
      - 'public/images/**'
  # 每小时运行一次，确保内容及时同步
  schedule:
    - cron: '0 * * * *'

jobs:
  sync-content:
    runs-on: ubuntu-latest
    env:
      # 由于内容仓库是公开的，直接使用 HTTPS URL:
      CONTENT_REPO_URL: https://gitee.com/niangao5142/mizuki-content.git
      CONTENT_DIR: ./src/content
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          ref: main
          persist-credentials: false

      - name: Set up Node
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: Install dependencies
        run: pnpm install

      - name: Sync content
        run: pnpm run sync-content

      - name: Commit changes
        run: |
          git config user.name "NianGao5142"
          git config user.email "3472217299@qq.com"
          git add .
          git commit -m "Sync content from public content repo" || echo "No changes to commit"
          git push

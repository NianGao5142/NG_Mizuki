---
import { siteConfig } from '../../../config';
import MainGridLayout from '../../../layouts/MainGridLayout.astro';
import { getDocumentById, resourceDocuments, type ResourceDocument } from '../../../content/resources/data';
import PDFViewer from '../../../components/document-viewer/PDFViewer.astro';
import WordViewer from '../../../components/document-viewer/WordViewer.astro';
import I18nKey from '../../../i18n/i18nKey';
import { i18n } from '../../../i18n/translation';

export const getStaticPaths = () => {
	return resourceDocuments.map((doc) => ({
		params: { id: doc.id },
		props: { document: doc },
	}));
};

interface Props {
	document: ResourceDocument;
}

const { document } = Astro.props;

if (!document) {
	return Astro.redirect('/404/');
}

const documentPath = `/resources/documents/${document.filename}`;
---

<MainGridLayout title={document.title} description={document.description || ''}>
	<script>
		import('../../../scripts/right-sidebar-layout.js');
	</script>
	<div class="flex w-full rounded-[var(--radius-large)] overflow-hidden relative min-h-32">
		<div class="card-base z-10 px-4 py-4 md:px-6 md:py-5 relative w-full">
			<div class="relative max-w-6xl w-full px-2 md:px-0">
				<div class="document-header mb-6">
					<div class="header-breadcrumb">
						<a href="/resources/" class="breadcrumb-link">
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<path d="M19 12H5M12 19l-7-7 7-7"/>
							</svg>
							{i18n(I18nKey.resources)}
						</a>
						<span class="breadcrumb-separator">/</span>
						<span class="breadcrumb-current">{document.title}</span>
					</div>

					<div class="header-content">
						<div class="document-icon">
							{document.type === 'pdf' ? (
								<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
									<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
									<polyline points="14 2 14 8 20 8"></polyline>
									<text x="12" y="16" text-anchor="middle" font-size="6" font-weight="bold">PDF</text>
								</svg>
							) : (
								<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
									<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
									<polyline points="14 2 14 8 20 8"></polyline>
									<text x="12" y="16" text-anchor="middle" font-size="5" font-weight="bold">DOCX</text>
								</svg>
							)}
						</div>

						<div class="document-info">
							<h1 class="document-title text-90">{document.title}</h1>
							{document.description && (
								<p class="document-description text-75">{document.description}</p>
							)}
							<div class="document-meta">
								<span class={`document-type ${document.type}`}>
									{document.type.toUpperCase()}
								</span>
								<span class="document-date text-75">
									<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
										<rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
										<line x1="16" y1="2" x2="16" y2="6"></line>
										<line x1="8" y1="2" x2="8" y2="6"></line>
										<line x1="3" y1="10" x2="21" y2="10"></line>
									</svg>
									{document.uploadDate}
								</span>
								{document.category && (
									<span class="document-category text-75">
										<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
											<path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
										</svg>
										{document.category}
									</span>
								)}
							</div>
						</div>
					</div>

					<div class="document-actions">
						<a href={documentPath} download class="action-btn primary">
							<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
								<polyline points="7 10 12 15 17 10"></polyline>
								<line x1="12" y1="15" x2="12" y2="3"></line>
							</svg>
							{i18n(I18nKey.resourcesDownload)}
						</a>
						<a href="/resources/" class="action-btn secondary">
							<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<path d="M19 12H5M12 19l-7-7 7-7"/>
							</svg>
							{i18n(I18nKey.resourcesBack)}
						</a>
					</div>
				</div>

				<div class="document-content">
					{document.type === 'pdf' ? <PDFViewer src={documentPath} /> : <WordViewer src={documentPath} />}
				</div>
			</div>
		</div>
	</div>
</MainGridLayout>

<style>
	.card-base {
		background: var(--card-bg);
		border: 1px solid var(--line-divider);
		transition: all 0.3s ease;
	}

	.document-header {
		padding: 1.5rem;
		border-radius: 12px;
		background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark, var(--primary)) 100%);
		color: white;
		margin-bottom: 2rem;
	}

	.header-breadcrumb {
		display: flex;
		align-items: center;
		gap: 0.5rem;
		margin-bottom: 1.5rem;
		font-size: 0.875rem;
	}

	.breadcrumb-link {
		display: flex;
		align-items: center;
		gap: 0.25rem;
		color: rgba(255, 255, 255, 0.8);
		text-decoration: none;
		transition: color 0.2s ease;
	}

	.breadcrumb-link:hover {
		color: white;
	}

	.breadcrumb-separator {
		color: rgba(255, 255, 255, 0.6);
	}

	.breadcrumb-current {
		color: white;
		font-weight: 500;
	}

	.header-content {
		display: flex;
		gap: 1.5rem;
		position: relative;
		z-index: 1;
	}

	.document-icon {
		flex-shrink: 0;
		display: flex;
		align-items: center;
		justify-content: center;
		width: 80px;
		height: 80px;
		background: rgba(255, 255, 255, 0.2);
		border-radius: 12px;
		color: white;
	}

	.document-info {
		flex: 1;
	}

	.document-title {
		font-size: 1.75rem;
		font-weight: bold;
		margin-bottom: 0.5rem;
		color: white;
		text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
	}

	.document-description {
		color: rgba(255, 255, 255, 0.9);
		font-size: 1rem;
		margin-bottom: 1rem;
	}

	.document-meta {
		display: flex;
		flex-wrap: wrap;
		gap: 1rem;
		align-items: center;
	}

	.document-type {
		padding: 0.375rem 0.75rem;
		border-radius: 6px;
		font-size: 0.875rem;
		font-weight: 600;
		text-transform: uppercase;
		background: rgba(255, 255, 255, 0.2);
		color: white;
	}

	.document-date,
	.document-category {
		display: flex;
		align-items: center;
		gap: 0.375rem;
		padding: 0.375rem 0.75rem;
		background: rgba(255, 255, 255, 0.15);
		border-radius: 6px;
		font-size: 0.875rem;
		color: rgba(255, 255, 255, 0.9);
	}

	.document-actions {
		display: flex;
		gap: 0.75rem;
		margin-top: 1.5rem;
	}

	.action-btn {
		display: flex;
		align-items: center;
		gap: 0.5rem;
		padding: 0.625rem 1.25rem;
		border-radius: 8px;
		text-decoration: none;
		font-size: 0.875rem;
		font-weight: 500;
		transition: all 0.2s ease;
	}

	.action-btn.primary {
		background: white;
		color: var(--primary);
	}

	.action-btn.primary:hover {
		transform: translateY(-1px);
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
	}

	.action-btn.secondary {
		background: rgba(255, 255, 255, 0.2);
		color: white;
		border: 1px solid rgba(255, 255, 255, 0.3);
	}

	.action-btn.secondary:hover {
		background: rgba(255, 255, 255, 0.3);
	}

	.document-content {
		background: var(--card-bg);
		border-radius: 12px;
		border: 1px solid var(--line-divider);
		overflow: hidden;
	}

	@media (max-width: 768px) {
		.header-content {
			flex-direction: column;
			text-align: center;
		}

		.document-icon {
			margin: 0 auto;
		}

		.document-meta {
			justify-content: center;
		}

		.document-actions {
			justify-content: center;
		}

		.document-title {
			font-size: 1.5rem;
		}
	}
</style>
